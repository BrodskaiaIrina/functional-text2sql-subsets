{
    "queries": [
        {
            "question": "Какие 7 учреждений имеют наибольшее количество международных коллабораций (с организациями за пределами России) за последние 3 года? Включите информацию об институтах, о количестве коллабораций, количестве связанных проектов и общем бюджете всех связанных проектов. Учитывайте только учреждения, имеющие отделы с бюджетом более 1000000 рублей.",
            "sql_query": "SELECT i.institution_id, i.name, i.country, i.city,\n       COUNT(DISTINCT c.collaboration_id) AS collaboration_count,\n       COUNT(DISTINCT c.project_id) AS project_count,\n       SUM(p.budget) AS total_budget\nFROM Institutions i\nJOIN Departments d ON i.institution_id = d.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN Collaborations c ON p.project_id = c.project_id\nJOIN Institutions i2 ON c.institution_id = i2.institution_id\nWHERE i2.country != 'Россия'\nAND c.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nAND d.budget > 1000000\nGROUP BY i.institution_id, i.name, i.country, i.city\nORDER BY collaboration_count DESC, total_budget DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 6 научных конференций за последние 2 года имели наибольшее количество презентаций, связанных с проектами со статусом 'Активный'? Включите информацию о конференции, о количестве презентаций, среднюю продолжительность презентаций и количество уникальных исследователей, выступавших на каждой конференции. Отсортируйте результаты по количеству презентаций в убывающем порядке.",
            "sql_query": "SELECT c.conference_id, c.name, c.location, c.start_date, c.end_date,\n       COUNT(DISTINCT pres.presentation_id) AS presentation_count,\n       AVG(pres.duration) AS avg_presentation_duration,\n       COUNT(DISTINCT pres.presenter_id) AS unique_presenters\nFROM Conferences c\nJOIN Presentations pres ON c.conference_id = pres.conference_id\nJOIN Projects p ON pres.project_id = p.project_id\nWHERE p.status = 'Активный'\nAND c.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY c.conference_id, c.name, c.location, c.start_date, c.end_date\nORDER BY presentation_count DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 8 отделов имеют наибольший процент одобренных этических заявок для проектов (включить подробную информацию о департаментах), начатых за последние 5 лет? Включите информацию об общем количестве заявок, количестве одобренных заявок, проценте одобрения и общем бюджете проектов с одобренными заявками. Учитывайте только отделы с более чем 3 заявками и где руководитель отдела родился после 1980 года.",
            "sql_query": "SELECT d.department_id, d.name, i.name AS institution_name,\n       COUNT(DISTINCT ea.approval_id) AS total_applications,\n       SUM(CASE WHEN ea.status = 'Одобрено' THEN 1 ELSE 0 END) AS approved_applications,\n       (SUM(CASE WHEN ea.status = 'Одобрено' THEN 1 ELSE 0 END) / COUNT(DISTINCT ea.approval_id)) * 100 AS approval_percentage,\n       SUM(CASE WHEN ea.status = 'Одобрено' THEN p.budget ELSE 0 END) AS total_approved_budget\nFROM Departments d\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Researchers r ON d.head_id = r.researcher_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN EthicsApprovals ea ON p.project_id = ea.project_id\nWHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nAND r.birth_date > '1980-01-01'\nGROUP BY d.department_id, d.name, i.name\nHAVING COUNT(DISTINCT ea.approval_id) > 3\nORDER BY approval_percentage DESC, total_approved_budget DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 9 исследователей имеют наибольшую продуктивность в публикациях с высоким импакт-фактором (>3.0) за последние 3 года и одновременно являются изобретателями патентов со статусом 'Получен'? Рассчитайте показатель продуктивности как соотношение количества публикаций к количеству лет работы исследователя, и отсортируйте по этому показателю в убывающем порядке.",
            "sql_query": "WITH PublicationCounts AS (\n    SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.birth_date,\n           COUNT(DISTINCT pub.publication_id) AS high_impact_publications,\n           YEAR(CURRENT_DATE) - YEAR(r.birth_date) - 22 AS years_of_experience\n    FROM Researchers r\n    JOIN Projects p ON r.researcher_id = p.project_lead_id\n    JOIN Publications pub ON p.project_id = pub.project_id\n    WHERE pub.impact_factor > 3.0\n    AND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\n    GROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.birth_date\n),\nPatentCounts AS (\n    SELECT r.researcher_id, COUNT(DISTINCT pt.patent_id) AS granted_patents\n    FROM Researchers r\n    JOIN Patents pt ON r.researcher_id = pt.inventor_id\n    WHERE pt.status = 'Получен'\n    GROUP BY r.researcher_id\n)\nSELECT pc.researcher_id, pc.first_name, pc.last_name, pc.position, \n       pc.high_impact_publications, \n       ptc.granted_patents,\n       pc.years_of_experience,\n       (pc.high_impact_publications / pc.years_of_experience) AS productivity_score\nFROM PublicationCounts pc\nJOIN PatentCounts ptc ON pc.researcher_id = ptc.researcher_id\nWHERE pc.years_of_experience > 0\nORDER BY productivity_score DESC, ptc.granted_patents DESC\nLIMIT 9;"
        },
        {
            "question": "Какие 12 проектов демонстрируют наиболее эффективное использование грантовых средств за последние 4 года, учитывая количество публикаций, патентов и проведенных экспериментов? Рассчитайте коэффициент эффективности как отношение суммы (количество публикаций * 5 + количество патентов * 10 + количество экспериментов * 2) к объему финансирования (в миллионах рублей), и отсортируйте результаты по этому коэффициенту в убывающем порядке.",
            "sql_query": "WITH ProjectMetrics AS (\n    SELECT p.project_id, p.title, p.budget, g.amount AS grant_amount,\n           p.start_date, p.end_date, p.status,\n           (SELECT COUNT(*) FROM Publications pub WHERE pub.project_id = p.project_id) AS publication_count,\n           (SELECT COUNT(*) FROM Patents pat WHERE pat.project_id = p.project_id) AS patent_count,\n           (SELECT COUNT(*) FROM Experiments exp WHERE exp.project_id = p.project_id) AS experiment_count\n    FROM Projects p\n    LEFT JOIN Grants g ON p.project_id = g.project_id\n    WHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\n    AND (g.amount > 0 OR p.budget > 0)\n)\nSELECT pm.project_id, pm.title, pm.start_date, pm.end_date, pm.status,\n       pm.publication_count, pm.patent_count, pm.experiment_count,\n       COALESCE(pm.grant_amount, pm.budget) AS total_funding,\n       ((pm.publication_count * 5) + (pm.patent_count * 10) + (pm.experiment_count * 2)) AS weighted_output,\n       ((pm.publication_count * 5) + (pm.patent_count * 10) + (pm.experiment_count * 2)) / (COALESCE(pm.grant_amount, pm.budget) / 1000000) AS efficiency_ratio\nFROM ProjectMetrics pm\nWHERE pm.publication_count + pm.patent_count + pm.experiment_count > 0\nORDER BY efficiency_ratio DESC\nLIMIT 12;"
        },
        {
            "question": "Какие 7 исследовательских коллабораций между учреждениями привели к наибольшему количеству совместных публикаций и патентов за последние 5 лет? Включите информацию об учреждениях-партнерах, типе коллаборации, общем количестве исследователей, вовлеченных в проекты, и средний импакт-фактор публикаций. Отсортируйте результаты по сумме публикаций и патентов в убывающем порядке.",
            "sql_query": "WITH CollaborationProjects AS (\n    SELECT c.collaboration_id, c.type, c.start_date, c.end_date,\n           i1.name AS host_institution, i1.country AS host_country,\n           i2.name AS partner_institution, i2.country AS partner_country,\n           c.project_id\n    FROM Collaborations c\n    JOIN Institutions i1 ON c.institution_id = i1.institution_id\n    JOIN Projects p ON c.project_id = p.project_id\n    JOIN Departments d ON p.department_id = d.department_id\n    JOIN Institutions i2 ON d.institution_id = i2.institution_id\n    WHERE c.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\n    AND i1.institution_id != i2.institution_id\n),\nCollaborationMetrics AS (\n    SELECT cp.collaboration_id, cp.host_institution, cp.host_country,\n           cp.partner_institution, cp.partner_country, cp.type,\n           COUNT(DISTINCT p.publication_id) AS publication_count,\n           AVG(p.impact_factor) AS avg_impact_factor,\n           COUNT(DISTINCT pt.patent_id) AS patent_count,\n           COUNT(DISTINCT r.researcher_id) AS researcher_count\n    FROM CollaborationProjects cp\n    LEFT JOIN Publications p ON cp.project_id = p.project_id\n    LEFT JOIN Patents pt ON cp.project_id = pt.project_id\n    LEFT JOIN Experiments e ON cp.project_id = e.project_id\n    LEFT JOIN Researchers r ON e.lead_researcher_id = r.researcher_id\n    GROUP BY cp.collaboration_id, cp.host_institution, cp.host_country, cp.partner_institution, cp.partner_country, cp.type\n)\nSELECT cm.collaboration_id, cm.host_institution, cm.host_country,\n       cm.partner_institution, cm.partner_country, cm.type,\n       cm.publication_count, cm.patent_count,\n       (cm.publication_count + cm.patent_count) AS total_output,\n       cm.researcher_count, cm.avg_impact_factor\nFROM CollaborationMetrics cm\nWHERE cm.publication_count + cm.patent_count > 0\nORDER BY total_output DESC, cm.avg_impact_factor DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 11 экспериментов демонстрируют наиболее интересные результаты с точки зрения количества собранных образцов различных типов и созданных наборов данных за последние 2 года? Включите информацию о проекте, ведущем исследователе, локации, состоянии эксперимента и общем количестве разнообразных типов собранных образцов. Отсортируйте результаты по количеству образцов и размеру наборов данных в убывающем порядке.",
            "sql_query": "WITH ExperimentDetails AS (\n    SELECT e.experiment_id, e.title AS experiment_title, e.start_date, e.end_date, e.status,\n           p.project_id, p.title AS project_title,\n           r.researcher_id, CONCAT(r.first_name, ' ', r.last_name) AS researcher_name,\n           e.location,\n           COUNT(DISTINCT s.sample_id) AS sample_count,\n           COUNT(DISTINCT s.type) AS sample_type_diversity,\n           SUM(s.quantity) AS total_sample_quantity\n    FROM Experiments e\n    JOIN Projects p ON e.project_id = p.project_id\n    JOIN Researchers r ON e.lead_researcher_id = r.researcher_id\n    LEFT JOIN Samples s ON e.experiment_id = s.experiment_id\n    WHERE e.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\n    GROUP BY e.experiment_id, e.title, e.start_date, e.end_date, e.status,\n             p.project_id, p.title, r.researcher_id, r.first_name, r.last_name, e.location\n),\nDatasetDetails AS (\n    SELECT ds.project_id, COUNT(ds.dataset_id) AS dataset_count, SUM(ds.size) AS total_dataset_size\n    FROM DataSets ds\n    WHERE ds.creation_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\n    GROUP BY ds.project_id\n)\nSELECT ed.experiment_id, ed.experiment_title, ed.status, ed.location,\n       ed.project_title, ed.researcher_name, ed.sample_count,\n       ed.sample_type_diversity, ed.total_sample_quantity,\n       COALESCE(dd.dataset_count, 0) AS dataset_count,\n       COALESCE(dd.total_dataset_size, 0) AS total_dataset_size,\n       (ed.sample_count * ed.sample_type_diversity + COALESCE(dd.dataset_count, 0) * 3) AS complexity_score\nFROM ExperimentDetails ed\nLEFT JOIN DatasetDetails dd ON ed.project_id = dd.project_id\nWHERE ed.sample_count > 0 OR COALESCE(dd.dataset_count, 0) > 0\nORDER BY complexity_score DESC, total_dataset_size DESC\nLIMIT 11;"
        },
        {
            "question": "Какие 6 научных областей (определенных по тематике отделов) показывают наиболее динамичное развитие за последние 3 года с точки зрения количества активных проектов, общего финансирования, количества экспериментов и разнообразия исследовательских коллабораций? Рассчитайте индекс динамики как сумму нормализованных метрик (количество проектов / макс. количество, объем финансирования / макс. объем и т.д.) и отсортируйте по этому индексу в убывающем порядке.",
            "sql_query": "WITH DepartmentMetrics AS (\n    SELECT d.department_id, d.name, i.name AS institution_name,\n           COUNT(DISTINCT p.project_id) AS project_count,\n           SUM(p.budget) AS total_budget,\n           COUNT(DISTINCT e.experiment_id) AS experiment_count,\n           COUNT(DISTINCT c.collaboration_id) AS collaboration_count,\n           COUNT(DISTINCT c.type) AS collaboration_diversity,\n           COUNT(DISTINCT pub.publication_id) AS publication_count,\n           AVG(pub.impact_factor) AS avg_impact_factor\n    FROM Departments d\n    JOIN Institutions i ON d.institution_id = i.institution_id\n    LEFT JOIN Projects p ON d.department_id = p.department_id\n                        AND p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\n                        AND p.status IN ('Активный', 'Планируется')\n    LEFT JOIN Experiments e ON p.project_id = e.project_id\n    LEFT JOIN Collaborations c ON p.project_id = c.project_id\n    LEFT JOIN Publications pub ON p.project_id = pub.project_id\n                              AND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\n    GROUP BY d.department_id, d.name, i.name\n),\nMaxValues AS (\n    SELECT MAX(project_count) AS max_projects,\n           MAX(total_budget) AS max_budget,\n           MAX(experiment_count) AS max_experiments,\n           MAX(collaboration_count) AS max_collaborations,\n           MAX(publication_count) AS max_publications,\n           MAX(avg_impact_factor) AS max_impact_factor\n    FROM DepartmentMetrics\n)\nSELECT dm.department_id, dm.name AS department_name, dm.institution_name,\n       dm.project_count, dm.total_budget, dm.experiment_count,\n       dm.collaboration_count, dm.collaboration_diversity,\n       dm.publication_count, dm.avg_impact_factor,\n       (dm.project_count / mv.max_projects + \n        dm.total_budget / mv.max_budget + \n        dm.experiment_count / mv.max_experiments + \n        dm.collaboration_count / mv.max_collaborations + \n        dm.publication_count / mv.max_publications + \n        dm.avg_impact_factor / mv.max_impact_factor) AS development_index\nFROM DepartmentMetrics dm, MaxValues mv\nWHERE dm.project_count > 0\nORDER BY development_index DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 8 учреждений демонстрируют наиболее сбалансированное гендерное распределение среди исследователей за последние 4 года, а также имеют высокую продуктивность публикаций на одного исследователя? Рассчитайте индекс гендерного баланса как отношение количества женщин-исследователей к общему числу исследователей (значение ближе к 0.5 считается более сбалансированным) и отсортируйте по этому показателю и продуктивности публикаций.",
            "sql_query": "WITH InstitutionResearchers AS (\n    SELECT i.institution_id, i.name, i.country, i.city, i.type,\n           COUNT(DISTINCT r.researcher_id) AS total_researchers,\n           SUM(CASE WHEN r.gender = 'Женский' THEN 1 ELSE 0 END) AS female_researchers,\n           SUM(CASE WHEN r.gender = 'Мужской' THEN 1 ELSE 0 END) AS male_researchers,\n           COUNT(DISTINCT pub.publication_id) AS total_publications\n    FROM Institutions i\n    JOIN Departments d ON i.institution_id = d.institution_id\n    JOIN Projects p ON d.department_id = p.department_id\n    JOIN Researchers r ON p.project_lead_id = r.researcher_id\n    LEFT JOIN Publications pub ON p.project_id = pub.project_id\n    WHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\n    GROUP BY i.institution_id, i.name, i.country, i.city, i.type\n    HAVING COUNT(DISTINCT r.researcher_id) >= 5\n)\nSELECT ir.institution_id, ir.name, ir.country, ir.city, ir.type,\n       ir.total_researchers, ir.female_researchers, ir.male_researchers,\n       (ir.female_researchers / ir.total_researchers) AS female_ratio,\n       ABS(0.5 - (ir.female_researchers / ir.total_researchers)) AS gender_balance_index,\n       (ir.total_publications / ir.total_researchers) AS publications_per_researcher\nFROM InstitutionResearchers ir\nWHERE ir.total_publications > 0\nORDER BY gender_balance_index, publications_per_researcher DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 14 образцов из различных экспериментов демонстрируют наиболее интересные характеристики с точки зрения типа, количества и времени хранения? Рассмотрите образцы с различными условиями хранения, собранные за последние 3 года, и вычислите индекс уникальности каждого образца на основе редкости его типа и условия хранения. Отсортируйте результаты по индексу уникальности в убывающем порядке.",
            "sql_query": "WITH SampleTypeCounts AS (\n    SELECT type, COUNT(*) AS type_count,\n           MIN(collection_date) AS first_collected,\n           MAX(collection_date) AS last_collected\n    FROM Samples\n    GROUP BY type\n),\nSampleConditionCounts AS (\n    SELECT `condition`, COUNT(*) AS condition_count\n    FROM Samples\n    GROUP BY `condition`\n),\nExperimentInfos AS (\n    SELECT e.experiment_id, e.title, p.title AS project_title,\n           CONCAT(r.first_name, ' ', r.last_name) AS researcher_name,\n           e.location, e.status\n    FROM Experiments e\n    JOIN Projects p ON e.project_id = p.project_id\n    JOIN Researchers r ON e.lead_researcher_id = r.researcher_id\n)\nSELECT s.sample_id, s.type, s.quantity, s.unit, s.`condition`, s.collection_date, s.storage_location,\n       DATEDIFF(CURRENT_DATE, s.collection_date) AS days_in_storage,\n       ei.title AS experiment_title, ei.project_title, ei.researcher_name, ei.location,\n       (1 / stc.type_count) * (1 / scc.condition_count) * s.quantity * 100 AS uniqueness_index\nFROM Samples s\nJOIN SampleTypeCounts stc ON s.type = stc.type\nJOIN SampleConditionCounts scc ON s.`condition` = scc.`condition`\nJOIN ExperimentInfos ei ON s.experiment_id = ei.experiment_id\nWHERE s.collection_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nAND s.status NOT IN ('Архивирован')\nORDER BY uniqueness_index DESC, days_in_storage ASC\nLIMIT 14;"
        },
        {
            "question": "Какие 13 проектов имеют наиболее короткий цикл от подачи заявки на этическое одобрение до получения одобрения за последние 2 года, и как это влияет на общую производительность проекта? Проанализируйте время рассмотрения этических заявок, количество условий в одобрениях, статус проектов и их общие результаты в виде публикаций и патентов. Отсортируйте по времени рассмотрения заявки (в днях) в возрастающем порядке.",
            "sql_query": "WITH EthicsApprovalTimes AS (\n    SELECT ea.project_id, \n           ea.application_date, ea.approval_date, \n           ea.status AS approval_status,\n           DATEDIFF(ea.approval_date, ea.application_date) AS days_to_approval,\n           LENGTH(ea.conditions) - LENGTH(REPLACE(ea.conditions, ' ', '')) + 1 AS condition_word_count,\n           CASE WHEN ea.conditions LIKE '%необходим%' THEN 1 ELSE 0 END AS has_requirements\n    FROM EthicsApprovals ea\n    WHERE ea.application_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\n    AND ea.approval_date IS NOT NULL\n),\nProjectOutputs AS (\n    SELECT p.project_id, p.title, p.status AS project_status, \n           p.start_date, p.end_date, p.budget,\n           COUNT(DISTINCT pub.publication_id) AS publication_count,\n           COUNT(DISTINCT pt.patent_id) AS patent_count,\n           COUNT(DISTINCT e.experiment_id) AS experiment_count\n    FROM Projects p\n    LEFT JOIN Publications pub ON p.project_id = pub.project_id\n    LEFT JOIN Patents pt ON p.project_id = pt.project_id\n    LEFT JOIN Experiments e ON p.project_id = e.project_id\n    GROUP BY p.project_id, p.title, p.status, p.start_date, p.end_date, p.budget\n),\nDepartmentInfo AS (\n    SELECT d.department_id, d.name AS department_name, i.name AS institution_name\n    FROM Departments d\n    JOIN Institutions i ON d.institution_id = i.institution_id\n)\nSELECT eat.project_id, po.title AS project_title, di.department_name, di.institution_name,\n       eat.application_date, eat.approval_date, eat.days_to_approval,\n       eat.approval_status, eat.condition_word_count, eat.has_requirements,\n       po.project_status, po.publication_count, po.patent_count, po.experiment_count,\n       (po.publication_count + po.patent_count + po.experiment_count) AS total_outputs,\n       (po.publication_count + po.patent_count + po.experiment_count) / (CASE WHEN eat.days_to_approval = 0 THEN 1 ELSE eat.days_to_approval END) AS productivity_per_approval_day\nFROM EthicsApprovalTimes eat\nJOIN ProjectOutputs po ON eat.project_id = po.project_id\nJOIN Projects p ON po.project_id = p.project_id\nJOIN Departments d ON p.department_id = d.department_id\nJOIN DepartmentInfo di ON d.department_id = di.department_id\nWHERE eat.days_to_approval > 0\nORDER BY eat.days_to_approval ASC, productivity_per_approval_day DESC\nLIMIT 13;"
        },
        {
            "question": "Какие 15 регионов России демонстрируют наибольшую научную активность в области экологических исследований за последние 5 лет? Проанализируйте количество институтов, проектов, публикаций, и экспериментов, связанных с экологическими исследованиями (определяемых по ключевым словам в названии) для каждого региона, и рассчитайте региональный индекс научной активности в этой области. Индекс рассчитывается как взвешенная сумма нормализованных показателей: количество институтов (10%), количество проектов (20%), объем финансирования проектов (10%), количество публикаций (30%), средний импакт-фактор публикаций (10%), количество экспериментов (10%) и количество образцов (10%).",
            "sql_query": "WITH RegionalInstitutions AS (\n    SELECT i.city AS region, \n           COUNT(DISTINCT i.institution_id) AS institution_count\n    FROM Institutions i\n    WHERE i.country = 'Россия'\n    GROUP BY i.city\n),\nEcoProjects AS (\n    SELECT i.city AS region, \n           COUNT(DISTINCT p.project_id) AS eco_project_count,\n           SUM(p.budget) AS total_eco_budget\n    FROM Projects p\n    JOIN Departments d ON p.department_id = d.department_id\n    JOIN Institutions i ON d.institution_id = i.institution_id\n    WHERE (p.title LIKE '%эколог%' OR p.title LIKE '%климат%' OR \n           p.title LIKE '%окружающ%' OR p.title LIKE '%устойчив%' OR \n           p.title LIKE '%биоразнообраз%' OR p.title LIKE '%экосистем%')\n    AND p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\n    AND i.country = 'Россия'\n    GROUP BY i.city\n),\nEcoPublications AS (\n    SELECT i.city AS region, \n           COUNT(DISTINCT pub.publication_id) AS eco_publication_count,\n           AVG(pub.impact_factor) AS avg_impact_factor\n    FROM Publications pub\n    JOIN Projects p ON pub.project_id = p.project_id\n    JOIN Departments d ON p.department_id = d.department_id\n    JOIN Institutions i ON d.institution_id = i.institution_id\n    WHERE (pub.title LIKE '%эколог%' OR pub.title LIKE '%климат%' OR \n           pub.title LIKE '%окружающ%' OR pub.title LIKE '%устойчив%' OR \n           pub.title LIKE '%биоразнообраз%' OR pub.title LIKE '%экосистем%')\n    AND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\n    AND i.country = 'Россия'\n    GROUP BY i.city\n),\nEcoExperiments AS (\n    SELECT i.city AS region, \n           COUNT(DISTINCT e.experiment_id) AS eco_experiment_count,\n           COUNT(DISTINCT s.sample_id) AS eco_sample_count\n    FROM Experiments e\n    JOIN Projects p ON e.project_id = p.project_id\n    JOIN Departments d ON p.department_id = d.department_id\n    JOIN Institutions i ON d.institution_id = i.institution_id\n    LEFT JOIN Samples s ON e.experiment_id = s.experiment_id\n    WHERE (e.title LIKE '%эколог%' OR e.title LIKE '%климат%' OR \n           e.title LIKE '%окружающ%' OR e.title LIKE '%устойчив%' OR \n           e.title LIKE '%биоразнообраз%' OR e.title LIKE '%экосистем%')\n    AND e.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\n    AND i.country = 'Россия'\n    GROUP BY i.city\n),\nMaxValues AS (\n    SELECT MAX(ri.institution_count) AS max_institutions,\n           MAX(ep.eco_project_count) AS max_projects,\n           MAX(ep.total_eco_budget) AS max_budget,\n           MAX(epb.eco_publication_count) AS max_publications,\n           MAX(epb.avg_impact_factor) AS max_impact_factor,\n           MAX(ee.eco_experiment_count) AS max_experiments,\n           MAX(ee.eco_sample_count) AS max_samples\n    FROM RegionalInstitutions ri\n    LEFT JOIN EcoProjects ep ON ri.region = ep.region\n    LEFT JOIN EcoPublications epb ON ri.region = epb.region\n    LEFT JOIN EcoExperiments ee ON ri.region = ee.region\n)\nSELECT ri.region,\n       ri.institution_count,\n       COALESCE(ep.eco_project_count, 0) AS eco_project_count,\n       COALESCE(ep.total_eco_budget, 0) AS total_eco_budget,\n       COALESCE(epb.eco_publication_count, 0) AS eco_publication_count,\n       COALESCE(epb.avg_impact_factor, 0) AS avg_impact_factor,\n       COALESCE(ee.eco_experiment_count, 0) AS eco_experiment_count,\n       COALESCE(ee.eco_sample_count, 0) AS eco_sample_count,\n       (COALESCE(ri.institution_count, 0) / mv.max_institutions * 0.1 +\n        COALESCE(ep.eco_project_count, 0) / mv.max_projects * 0.2 +\n        COALESCE(ep.total_eco_budget, 0) / mv.max_budget * 0.1 +\n        COALESCE(epb.eco_publication_count, 0) / mv.max_publications * 0.3 +\n        COALESCE(epb.avg_impact_factor, 0) / mv.max_impact_factor * 0.1 +\n        COALESCE(ee.eco_experiment_count, 0) / mv.max_experiments * 0.1 +\n        COALESCE(ee.eco_sample_count, 0) / mv.max_samples * 0.1) AS eco_research_index\nFROM RegionalInstitutions ri\nLEFT JOIN EcoProjects ep ON ri.region = ep.region\nLEFT JOIN EcoPublications epb ON ri.region = epb.region\nLEFT JOIN EcoExperiments ee ON ri.region = ee.region\nCROSS JOIN MaxValues mv\nWHERE COALESCE(ep.eco_project_count, 0) > 0 OR COALESCE(epb.eco_publication_count, 0) > 0\nORDER BY eco_research_index DESC\nLIMIT 15;"
        },
        {
            "question": "Какие 8 исследователей имеют наибольшее количество экспериментов в статусе 'Завершено' с использованием оборудования стоимостью более 500000 рублей за последние 4 года? Включите информацию о количестве образцов, связанных с их экспериментами, и средней продолжительности экспериментов в днях. Отсортируйте результаты по количеству экспериментов в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.email,\n       COUNT(DISTINCT e.experiment_id) AS experiment_count,\n       COUNT(DISTINCT s.sample_id) AS sample_count,\n       AVG(DATEDIFF(e.end_date, e.start_date)) AS avg_experiment_duration_days\nFROM Researchers r\nJOIN Experiments e ON r.researcher_id = e.lead_researcher_id\nJOIN Equipment eq ON e.equipment_id = eq.equipment_id\nLEFT JOIN Samples s ON e.experiment_id = s.experiment_id\nWHERE e.status = 'Завершено'\nAND eq.cost > 500000\nAND e.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.email\nORDER BY experiment_count DESC, sample_count DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 5 отделов имеют наибольшее соотношение успешных патентов (статус 'Получен') к общему количеству проектов за последние 5 лет? Включите информацию о количестве исследователей в каждом отделе, общем бюджете проектов и среднем импакт-факторе связанных публикаций. Рассматривайте только отделы с не менее чем 3 патентами и 5 проектами.",
            "sql_query": "SELECT d.department_id, d.name, i.name AS institution_name,\n       COUNT(DISTINCT pat.patent_id) AS patents_count,\n       COUNT(DISTINCT p.project_id) AS projects_count,\n       (COUNT(DISTINCT pat.patent_id) * 1.0 / COUNT(DISTINCT p.project_id)) AS patent_to_project_ratio,\n       COUNT(DISTINCT r.researcher_id) AS researchers_count,\n       SUM(p.budget) AS total_budget,\n       AVG(pub.impact_factor) AS avg_impact_factor\nFROM Departments d\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nLEFT JOIN Patents pat ON p.project_id = pat.project_id AND pat.status = 'Получен'\nLEFT JOIN Publications pub ON p.project_id = pub.project_id\nLEFT JOIN Researchers r ON d.head_id = r.researcher_id\nWHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nGROUP BY d.department_id, d.name, i.name\nHAVING COUNT(DISTINCT pat.patent_id) >= 3 AND COUNT(DISTINCT p.project_id) >= 5\nORDER BY patent_to_project_ratio DESC, total_budget DESC\nLIMIT 5;"
        },
        {
            "question": "Какие 12 проектов имеют наибольшее количество связанных датасетов со статусом 'Активный' и при этом не имеют ни одного образца в статусе 'Архивирован'? Включите информацию о руководителе проекта, финансирующем агентстве, общем количестве презентаций на конференциях и суммарном размере всех связанных датасетов. Отсортируйте результаты по количеству датасетов и общему размеру данных в убывающем порядке.",
            "sql_query": "SELECT p.project_id, p.title, p.budget, p.funding_agency, p.status,\n       r.first_name, r.last_name, r.position,\n       COUNT(DISTINCT ds.dataset_id) AS datasets_count,\n       SUM(ds.size) AS total_data_size,\n       COUNT(DISTINCT pres.presentation_id) AS presentations_count\nFROM Projects p\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nJOIN DataSets ds ON p.project_id = ds.project_id\nLEFT JOIN Presentations pres ON p.project_id = pres.project_id\nLEFT JOIN Experiments e ON p.project_id = e.project_id\nLEFT JOIN Samples s ON e.experiment_id = s.experiment_id\nWHERE ds.status = 'Активный'\nAND p.project_id NOT IN (\n    SELECT DISTINCT e2.project_id\n    FROM Experiments e2\n    JOIN Samples s2 ON e2.experiment_id = s2.experiment_id\n    WHERE s2.status = 'Архивирован'\n)\nGROUP BY p.project_id, p.title, p.budget, p.funding_agency, p.status, r.first_name, r.last_name, r.position\nORDER BY datasets_count DESC, total_data_size DESC\nLIMIT 12;"
        },
        {
            "question": "Какие 9 исследователей получили наибольшее количество грантов в статусе 'Активный' с общей суммой финансирования более 10000000 рублей за последние 3 года? Включите информацию о количестве их публикаций, среднем импакт-факторе этих публикаций и всех учреждениях, с которыми они сотрудничали. Отсортируйте результаты по общей сумме грантов в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.nationality,\n       COUNT(DISTINCT g.grant_id) AS grants_count,\n       SUM(g.amount) AS total_grant_amount,\n       COUNT(DISTINCT pub.publication_id) AS publications_count,\n       AVG(pub.impact_factor) AS avg_impact_factor,\n       GROUP_CONCAT(DISTINCT i.name ORDER BY i.name SEPARATOR ', ') AS collaborating_institutions\nFROM Researchers r\nJOIN Projects p ON r.researcher_id = p.project_lead_id\nJOIN Grants g ON p.project_id = g.project_id\nLEFT JOIN Publications pub ON p.project_id = pub.project_id\nLEFT JOIN Collaborations c ON p.project_id = c.project_id\nLEFT JOIN Institutions i ON c.institution_id = i.institution_id\nWHERE g.status = 'Активный'\nAND g.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.nationality\nHAVING SUM(g.amount) > 10000000\nORDER BY total_grant_amount DESC\nLIMIT 9;"
        },
        {
            "question": "Какие 15 учреждений имеют наибольшую 'эффективность исследований', рассчитанную как отношение общего количества публикаций к количеству исследователей за последние 3 года? Учитывайте только учреждения со средним импакт-фактором публикаций выше 3.0 и с не менее чем 5 исследователями. Включите информацию о стране, городе, году основания и общем бюджете проектов. Отсортируйте результаты по коэффициенту эффективности и среднему импакт-фактору в убывающем порядке.",
            "sql_query": "SELECT i.institution_id, i.name, i.country, i.city, i.established_year, i.type,\n       COUNT(DISTINCT r.researcher_id) AS researcher_count,\n       COUNT(DISTINCT pub.publication_id) AS publication_count,\n       (COUNT(DISTINCT pub.publication_id) * 1.0 / COUNT(DISTINCT r.researcher_id)) AS research_efficiency,\n       AVG(pub.impact_factor) AS avg_impact_factor,\n       SUM(p.budget) AS total_project_budget\nFROM Institutions i\nJOIN Departments d ON i.institution_id = d.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nJOIN Publications pub ON p.project_id = pub.project_id\nWHERE pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nGROUP BY i.institution_id, i.name, i.country, i.city, i.established_year, i.type\nHAVING COUNT(DISTINCT r.researcher_id) >= 5 AND AVG(pub.impact_factor) > 3.0\nORDER BY research_efficiency DESC, avg_impact_factor DESC\nLIMIT 15;"
        },
        {
            "question": "Какие 11 исследователей моложе 40 лет имеют наибольшее соотношение количества презентаций к количеству проектов за последние 2 года? Включите информацию о количестве публикаций, среднем импакт-факторе, количестве патентов и учреждении, в котором они работают. Рассматривайте только исследователей, у которых есть хотя бы одна публикация с импакт-фактором выше 4.0 и хотя бы один патент со статусом 'Получен'. Отсортируйте результаты по соотношению презентаций к проектам в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.gender, r.nationality,\n       TIMESTAMPDIFF(YEAR, r.birth_date, CURRENT_DATE) AS age,\n       COUNT(DISTINCT pres.presentation_id) AS presentations_count,\n       COUNT(DISTINCT p.project_id) AS projects_count,\n       (COUNT(DISTINCT pres.presentation_id) * 1.0 / COUNT(DISTINCT p.project_id)) AS presentation_to_project_ratio,\n       COUNT(DISTINCT pub.publication_id) AS publications_count,\n       AVG(pub.impact_factor) AS avg_impact_factor,\n       COUNT(DISTINCT pat.patent_id) AS patents_count,\n       i.name AS institution_name\nFROM Researchers r\nJOIN Projects p ON r.researcher_id = p.project_lead_id\nJOIN Presentations pres ON p.project_id = pres.project_id\nJOIN Publications pub ON p.project_id = pub.project_id\nJOIN Patents pat ON p.project_id = pat.project_id\nJOIN Departments d ON p.department_id = d.department_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nWHERE TIMESTAMPDIFF(YEAR, r.birth_date, CURRENT_DATE) < 40\nAND pres.date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nAND pat.status = 'Получен'\nAND r.researcher_id IN (\n    SELECT DISTINCT r2.researcher_id\n    FROM Researchers r2\n    JOIN Projects p2 ON r2.researcher_id = p2.project_lead_id\n    JOIN Publications pub2 ON p2.project_id = pub2.project_id\n    WHERE pub2.impact_factor > 4.0\n)\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.gender, r.nationality, r.birth_date, i.name\nHAVING COUNT(DISTINCT p.project_id) > 0\nORDER BY presentation_to_project_ratio DESC\nLIMIT 11;"
        },
        {
            "question": "Какие 6 отделов с наибольшим количеством оборудования (минимум 3 единицы) имеют наименьший процент экспериментов в статусе 'Завершено' по отношению к общему количеству экспериментов за последние 3 года? Включите информацию о заведующем отделом, учреждении, общем бюджете отдела, количестве проектов и общем количестве сотрудников. Отсортируйте результаты по проценту завершенных экспериментов в возрастающем порядке.",
            "sql_query": "SELECT d.department_id, d.name, d.number_of_staff, d.budget,\n       r.first_name AS head_first_name, r.last_name AS head_last_name, r.position AS head_position,\n       i.name AS institution_name, i.city, i.country,\n       COUNT(DISTINCT eq.equipment_id) AS equipment_count,\n       COUNT(DISTINCT e.experiment_id) AS total_experiments,\n       SUM(CASE WHEN e.status = 'Завершено' THEN 1 ELSE 0 END) AS completed_experiments,\n       (SUM(CASE WHEN e.status = 'Завершено' THEN 1 ELSE 0 END) * 100.0 / COUNT(DISTINCT e.experiment_id)) AS completed_experiments_percentage,\n       COUNT(DISTINCT p.project_id) AS projects_count\nFROM Departments d\nJOIN Researchers r ON d.head_id = r.researcher_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Equipment eq ON d.department_id = eq.department_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN Experiments e ON p.project_id = e.project_id\nWHERE e.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nGROUP BY d.department_id, d.name, d.number_of_staff, d.budget, r.first_name, r.last_name, r.position, i.name, i.city, i.country\nHAVING COUNT(DISTINCT eq.equipment_id) >= 3 AND COUNT(DISTINCT e.experiment_id) > 0\nORDER BY completed_experiments_percentage ASC, equipment_count DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 13 самых эффективных проектов с точки зрения соотношения количества публикаций к затраченному бюджету (в расчете на миллион рублей) проводятся или были проведены за последние 5 лет? Включите информацию о руководителе проекта, отделе, учреждении, статусе проекта, финансирующем агентстве, среднем импакт-факторе публикаций и общем количестве связанных датасетов. Рассматривайте только проекты с бюджетом более 500000 рублей и с не менее чем 2 публикациями. Отсортируйте результаты по эффективности затрат в убывающем порядке.",
            "sql_query": "SELECT p.project_id, p.title, p.status, p.budget, p.funding_agency,\n       r.first_name AS lead_first_name, r.last_name AS lead_last_name, r.position AS lead_position,\n       d.name AS department_name, i.name AS institution_name,\n       COUNT(DISTINCT pub.publication_id) AS publications_count,\n       (COUNT(DISTINCT pub.publication_id) * 1000000.0 / p.budget) AS publications_per_million,\n       AVG(pub.impact_factor) AS avg_impact_factor,\n       COUNT(DISTINCT ds.dataset_id) AS datasets_count\nFROM Projects p\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nJOIN Departments d ON p.department_id = d.department_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Publications pub ON p.project_id = pub.project_id\nLEFT JOIN DataSets ds ON p.project_id = ds.project_id\nWHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nAND p.budget > 500000\nGROUP BY p.project_id, p.title, p.status, p.budget, p.funding_agency, r.first_name, r.last_name, r.position, d.name, i.name\nHAVING COUNT(DISTINCT pub.publication_id) >= 2\nORDER BY publications_per_million DESC\nLIMIT 13;"
        },
        {
            "question": "Какие 8 исследователей опубликовали наибольшее количество статей за последние 3 года с импакт-фактором выше среднего? Включите информацию об их должности, количестве статей, среднем импакт-факторе и названии проекта с наивысшим бюджетом, в котором они участвуют. Отсортируйте результаты по количеству публикаций в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position,\n       COUNT(DISTINCT pub.publication_id) AS publication_count,\n       AVG(pub.impact_factor) AS avg_impact_factor,\n       (SELECT p2.title FROM Projects p2 WHERE p2.project_lead_id = r.researcher_id ORDER BY p2.budget DESC LIMIT 1) AS highest_budget_project\nFROM Researchers r\nJOIN Projects p ON r.researcher_id = p.project_lead_id\nJOIN Publications pub ON p.project_id = pub.project_id\nWHERE pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nAND pub.impact_factor > (SELECT AVG(impact_factor) FROM Publications)\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position\nORDER BY publication_count DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 5 проектов со статусом 'Активный' имеют наибольшее количество образцов типа 'Грунт' или 'Вода', собранных за последние 2 года? Включите информацию о руководителе проекта, общем бюджете, количестве экспериментов и среднем количестве образцов на эксперимент. Отсортируйте результаты по количеству образцов в убывающем порядке.",
            "sql_query": "SELECT p.project_id, p.title, p.budget, p.funding_agency,\n       r.first_name AS lead_first_name, r.last_name AS lead_last_name,\n       COUNT(DISTINCT s.sample_id) AS sample_count,\n       COUNT(DISTINCT e.experiment_id) AS experiment_count,\n       COUNT(DISTINCT s.sample_id) / COUNT(DISTINCT e.experiment_id) AS avg_samples_per_experiment\nFROM Projects p\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nJOIN Experiments e ON p.project_id = e.project_id\nJOIN Samples s ON e.experiment_id = s.experiment_id\nWHERE p.status = 'Активный'\nAND (s.type = 'Грунт' OR s.type = 'Вода')\nAND s.collection_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY p.project_id, p.title, p.budget, p.funding_agency, r.first_name, r.last_name\nORDER BY sample_count DESC\nLIMIT 5;"
        },
        {
            "question": "Какие 4 отдела имеют наибольшее количество патентов со статусом 'Получен' за последние 5 лет? Включите информацию о руководителе отдела, учреждении, общем бюджете и соотношении количества патентов к количеству исследователей. Отсортируйте результаты по количеству патентов в убывающем порядке.",
            "sql_query": "SELECT d.department_id, d.name, d.budget, d.number_of_staff,\n       i.name AS institution_name,\n       r.first_name AS head_first_name, r.last_name AS head_last_name,\n       COUNT(DISTINCT pat.patent_id) AS patent_count,\n       COUNT(DISTINCT pat.patent_id) / d.number_of_staff AS patents_per_researcher\nFROM Departments d\nJOIN Researchers r ON d.head_id = r.researcher_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN Patents pat ON p.project_id = pat.project_id\nWHERE pat.status = 'Получен'\nAND pat.grant_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nGROUP BY d.department_id, d.name, d.budget, d.number_of_staff, i.name, r.first_name, r.last_name\nORDER BY patent_count DESC\nLIMIT 4;"
        },
        {
            "question": "Какие 6 экспериментов привели к наибольшему количеству публикаций с импакт-фактором выше 3.0 за последние 4 года? Включите информацию о статусе эксперимента, руководителе, используемом оборудовании и среднем импакт-факторе связанных публикаций. Отсортируйте результаты по количеству публикаций и среднему импакт-фактору в убывающем порядке.",
            "sql_query": "SELECT e.experiment_id, e.title, e.status, e.location,\n       r.first_name AS lead_first_name, r.last_name AS lead_last_name,\n       eq.name AS equipment_name, eq.model,\n       COUNT(DISTINCT pub.publication_id) AS publication_count,\n       AVG(pub.impact_factor) AS avg_impact_factor\nFROM Experiments e\nJOIN Researchers r ON e.lead_researcher_id = r.researcher_id\nJOIN Equipment eq ON e.equipment_id = eq.equipment_id\nJOIN Projects p ON e.project_id = p.project_id\nJOIN Publications pub ON p.project_id = pub.project_id\nWHERE pub.impact_factor > 3.0\nAND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\nGROUP BY e.experiment_id, e.title, e.status, e.location, r.first_name, r.last_name, eq.name, eq.model\nORDER BY publication_count DESC, avg_impact_factor DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 7 фондов финансирования имеют наибольшую сумму активных грантов за последние 2 года? Включите название агентства, количество грантов, общую сумму финансирования и средний размер гранта. Отсортируйте по общей сумме и ограничьте 7.",
            "sql_query": "SELECT g.funding_agency, COUNT(*) AS grants_count, SUM(g.amount) AS total_amount, AVG(g.amount) AS avg_amount\nFROM Grants g\nWHERE g.status = 'Активный'\n  AND g.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY g.funding_agency\nORDER BY total_amount DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 6 отделов имеют наибольшую нагрузку бюджета за последние 3 года, рассчитанную как отношение суммы бюджетов проектов к бюджету отдела? Включите идентификатор отдела, название, название института, бюджет отдела, суммарный бюджет проектов и коэффициент нагрузки. Отсортируйте по коэффициенту и ограничьте 6.",
            "sql_query": "SELECT d.department_id, d.name, i.name AS institution_name, d.budget AS department_budget, SUM(p.budget) AS projects_budget_sum, SUM(p.budget) / d.budget AS budget_load_ratio\nFROM Departments d\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nWHERE p.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nGROUP BY d.department_id, d.name, i.name, d.budget\nHAVING COUNT(DISTINCT p.project_id) >= 2\nORDER BY budget_load_ratio DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 8 исследователей за последние 5 лет одновременно получили патенты и опубликовали статьи? Включите имя исследователя, количество патентов, количество публикаций и средний импакт-фактор. Отсортируйте по количеству патентов, затем по публикациям и ограничьте 8.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, COUNT(DISTINCT pat.patent_id) AS patents_count, COUNT(DISTINCT pub.publication_id) AS publications_count, AVG(pub.impact_factor) AS avg_impact_factor\nFROM Researchers r\nJOIN Projects p ON r.researcher_id = p.project_lead_id\nJOIN Patents pat ON p.project_id = pat.project_id\nJOIN Publications pub ON p.project_id = pub.project_id\nWHERE pat.grant_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\n  AND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nGROUP BY r.researcher_id, r.first_name, r.last_name\nHAVING patents_count > 0 AND publications_count > 0\nORDER BY patents_count DESC, publications_count DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 7 образцов в статусе 'Активный' имеют наибольший объем хранения (в единицах измерения)? Включите информацию о типе образца, условии хранения, дате сбора и эксперименте, к которому они относятся. Отсортируйте результаты по объему образца в убывающем порядке за последние 18 месяцев.",
            "sql_query": "SELECT s.sample_id, s.type, s.quantity, s.unit, s.condition, s.collection_date, s.storage_location,\n       e.title AS experiment_title, e.location AS experiment_location\nFROM Samples s\nJOIN Experiments e ON s.experiment_id = e.experiment_id\nWHERE s.status = 'Активный'\nAND s.collection_date >= DATE_SUB(CURRENT_DATE, INTERVAL 18 MONTH)\nORDER BY s.quantity DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 10 проектов имеют связанные датасеты в формате 'CSV' или 'JSON' с уровнем доступа 'Открытый'? Включите информацию о названии проекта, руководителе, финансирующем агентстве, количестве датасетов и их общем размере. Отсортируйте результаты по общему размеру данных в убывающем порядке за последние 2 года.",
            "sql_query": "SELECT p.project_id, p.title, p.status, p.funding_agency,\n       r.first_name, r.last_name, r.position,\n       COUNT(DISTINCT ds.dataset_id) AS datasets_count,\n       SUM(ds.size) AS total_data_size\nFROM Projects p\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nJOIN DataSets ds ON p.project_id = ds.project_id\nWHERE (ds.format = 'CSV' OR ds.format = 'JSON')\nAND ds.access_level = 'Открытый'\nAND ds.creation_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY p.project_id, p.title, p.status, p.funding_agency, r.first_name, r.last_name, r.position\nORDER BY total_data_size DESC\nLIMIT 10;"
        },
        {
            "question": "Какие 6 исследователей женского пола имеют наибольшее количество завершенных экспериментов в различных городах за последние 4 года? Включите информацию о должности, гражданстве, количестве экспериментов, уникальных локациях и среднем бюджете проектов. Отсортируйте результаты по количеству экспериментов в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.nationality,\n       COUNT(DISTINCT e.experiment_id) AS experiments_count,\n       COUNT(DISTINCT e.location) AS unique_locations,\n       AVG(p.budget) AS avg_project_budget\nFROM Researchers r\nJOIN Experiments e ON r.researcher_id = e.lead_researcher_id\nJOIN Projects p ON e.project_id = p.project_id\nWHERE r.gender = 'Женский'\nAND e.status = 'Завершено'\nAND e.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.nationality\nORDER BY experiments_count DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 12 коллабораций типа 'Исследовательский' или 'Технический' имеют наибольшую продолжительность (в днях) среди всех активных на данный момент? Включите информацию об учреждениях-участниках, контактных лицах и общем бюджете связанных проектов. Отсортируйте результаты по продолжительности в убывающем порядке.",
            "sql_query": "SELECT c.collaboration_id, c.type, c.description,\n       i.name AS institution_name, i.country, i.city,\n       c.contact_person, c.contact_email,\n       DATEDIFF(COALESCE(c.end_date, CURRENT_DATE), c.start_date) AS duration_days,\n       SUM(p.budget) AS total_projects_budget\nFROM Collaborations c\nJOIN Institutions i ON c.institution_id = i.institution_id\nJOIN Projects p ON c.project_id = p.project_id\nWHERE (c.type = 'Исследовательский' OR c.type = 'Технический')\nAND (c.end_date IS NULL OR c.end_date >= CURRENT_DATE)\nGROUP BY c.collaboration_id, c.type, c.description, i.name, i.country, i.city, c.contact_person, c.contact_email, c.start_date, c.end_date\nORDER BY duration_days DESC\nLIMIT 12;"
        },
        {
            "question": "Какие 9 образцов в состоянии 'В обработке' или 'Очистка' имеют наименьшее время хранения? Включите информацию о типе образца, месте хранения, описании и связанном эксперименте. Отсортируйте результаты по времени хранения в возрастающем порядке.",
            "sql_query": "SELECT s.sample_id, s.type, s.status, s.storage_location, s.description,\n       s.collection_date, s.condition,\n       DATEDIFF(CURRENT_DATE, s.collection_date) AS storage_days,\n       e.title AS experiment_title, e.status AS experiment_status\nFROM Samples s\nJOIN Experiments e ON s.experiment_id = e.experiment_id\nWHERE s.status IN ('В обработке', 'Очистка')\nORDER BY storage_days ASC\nLIMIT 9;"
        },
        {
            "question": "Какие 5 грантов со статусом 'Планирование' имеют наибольшую сумму финансирования на единицу времени (рублей в день)? Включите информацию об агентстве финансирования, дате начала, длительности в днях и цели гранта. Отсортируйте результаты по коэффициенту финансирования в убывающем порядке.",
            "sql_query": "SELECT g.grant_id, g.title, g.funding_agency, g.amount, g.purpose,\n       g.start_date, g.end_date,\n       DATEDIFF(g.end_date, g.start_date) AS duration_days,\n       g.amount / DATEDIFF(g.end_date, g.start_date) AS funding_per_day,\n       p.title AS project_title\nFROM Grants g\nJOIN Projects p ON g.project_id = p.project_id\nWHERE g.status = 'Планирование'\nAND DATEDIFF(g.end_date, g.start_date) > 0\nORDER BY funding_per_day DESC\nLIMIT 5;"
        },
        {
            "question": "Какие 11 учреждений типа 'Университет' имеют наибольшее соотношение количества презентаций к количеству конференций за последние 3 года? Включите информацию о названии университета, городе, общем количестве презентаций и среднем времени презентации. Отсортируйте результаты по эффективности презентаций в убывающем порядке.",
            "sql_query": "SELECT i.institution_id, i.name, i.city, i.established_year,\n       COUNT(DISTINCT pres.presentation_id) AS presentations_count,\n       COUNT(DISTINCT c.conference_id) AS conferences_count,\n       COUNT(DISTINCT pres.presentation_id) / COUNT(DISTINCT c.conference_id) AS presentation_ratio,\n       AVG(pres.duration) AS avg_presentation_duration\nFROM Institutions i\nJOIN Departments d ON i.institution_id = d.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nJOIN Presentations pres ON p.project_id = pres.project_id\nJOIN Conferences c ON pres.conference_id = c.conference_id\nWHERE i.type = 'Университет'\nAND c.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nGROUP BY i.institution_id, i.name, i.city, i.established_year\nHAVING COUNT(DISTINCT c.conference_id) > 0\nORDER BY presentation_ratio DESC\nLIMIT 11;"
        },
        {
            "question": "Какие 7 экспериментов в статусе 'В процессе' используют оборудование, приобретенное в течение последних 3 лет, и имеют связанные образцы в состоянии 'Герметичный' или 'Запечатанный'? Включите информацию о руководителе эксперимента, названии оборудования и количестве образцов. Отсортируйте результаты по дате начала эксперимента в убывающем порядке.",
            "sql_query": "SELECT e.experiment_id, e.title, e.start_date, e.location,\n       r.first_name AS lead_first_name, r.last_name AS lead_last_name,\n       eq.name AS equipment_name, eq.model, eq.purchase_date,\n       COUNT(DISTINCT s.sample_id) AS sealed_samples_count\nFROM Experiments e\nJOIN Researchers r ON e.lead_researcher_id = r.researcher_id\nJOIN Equipment eq ON e.equipment_id = eq.equipment_id\nJOIN Samples s ON e.experiment_id = s.experiment_id\nWHERE e.status = 'В процессе'\nAND eq.purchase_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nAND s.condition IN ('Герметичный', 'Запечатанный')\nGROUP BY e.experiment_id, e.title, e.start_date, e.location, r.first_name, r.last_name, eq.name, eq.model, eq.purchase_date\nORDER BY e.start_date DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 4 отдела, размещенные в 'Главное здание', имеют наибольшее количество датасетов в формате 'XLSX' или 'FASTA' с уровнем доступа 'Закрытый' или 'Ограниченный'? Включите информацию о названии отдела, количестве сотрудников, общем бюджете и суммарном размере всех датасетов. Отсортируйте результаты по количеству датасетов в убывающем порядке.",
            "sql_query": "SELECT d.department_id, d.name, d.building, d.number_of_staff, d.budget,\n       COUNT(DISTINCT ds.dataset_id) AS datasets_count,\n       SUM(ds.size) AS total_data_size\nFROM Departments d\nJOIN Projects p ON d.department_id = p.department_id\nJOIN DataSets ds ON p.project_id = ds.project_id\nWHERE d.building = 'Главное здание'\nAND (ds.format = 'XLSX' OR ds.format = 'FASTA')\nAND (ds.access_level = 'Закрытый' OR ds.access_level = 'Ограниченный')\nGROUP BY d.department_id, d.name, d.building, d.number_of_staff, d.budget\nORDER BY datasets_count DESC\nLIMIT 4;"
        },
        {
            "question": "Какие 6 образцов в состоянии 'Замороженный' хранятся дольше всего и имеют связанные эксперименты со статусом 'Завершено'? Включите информацию о типе образца, дате сбора, длительности хранения в днях и данных эксперимента. Отсортируйте результаты по длительности хранения в убывающем порядке.",
            "sql_query": "SELECT s.sample_id, s.type, s.condition, s.collection_date, s.storage_location,\n       DATEDIFF(CURRENT_DATE, s.collection_date) AS storage_days,\n       e.title AS experiment_title, e.status AS experiment_status,\n       r.first_name, r.last_name\nFROM Samples s\nJOIN Experiments e ON s.experiment_id = e.experiment_id\nJOIN Researchers r ON e.lead_researcher_id = r.researcher_id\nWHERE s.condition = 'Замороженный'\nAND e.status = 'Завершено'\nORDER BY storage_days DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 8 датасетов со статусом 'Архивный' были созданы в последние 5 лет и имеют размер более 20 ГБ? Включите информацию о названии датасета, проекте, формате, уровне доступа и дате создания. Отсортируйте результаты по размеру в убывающем порядке.",
            "sql_query": "SELECT ds.dataset_id, ds.title, ds.format, ds.access_level, ds.creation_date, ds.size,\n       p.title AS project_title, p.status AS project_status,\n       i.name AS institution_name\nFROM DataSets ds\nJOIN Projects p ON ds.project_id = p.project_id\nJOIN Departments d ON p.department_id = d.department_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nWHERE ds.status = 'Архивный'\nAND ds.creation_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nAND ds.size > 20\nORDER BY ds.size DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 10 патентов со статусом 'Ожидается', поданных за последние 3 года, имеют наибольшее время ожидания? Включите информацию о названии патента, изобретателе, стране и связанном проекте. Отсортируйте результаты по времени ожидания в убывающем порядке.",
            "sql_query": "SELECT pat.patent_id, pat.title, pat.application_date, pat.patent_number, pat.country,\n       DATEDIFF(CURRENT_DATE, pat.application_date) AS waiting_days,\n       r.first_name, r.last_name, r.position,\n       p.title AS project_title\nFROM Patents pat\nJOIN Researchers r ON pat.inventor_id = r.researcher_id\nJOIN Projects p ON pat.project_id = p.project_id\nWHERE pat.status = 'Ожидается'\nAND pat.application_date >= DATE_SUB(CURRENT_DATE, INTERVAL 3 YEAR)\nORDER BY waiting_days DESC\nLIMIT 10;"
        },
        {
            "question": "Какие 7 коллабораций типа 'Образовательный' связаны с проектами, имеющими наибольшее количество презентаций за последние 2 года? Включите информацию о контактном лице, организации-партнере, длительности коллаборации в месяцах и количестве презентаций. Отсортируйте результаты по количеству презентаций в убывающем порядке.",
            "sql_query": "SELECT c.collaboration_id, c.type, c.description, c.contact_person,\n       TIMESTAMPDIFF(MONTH, c.start_date, COALESCE(c.end_date, CURRENT_DATE)) AS duration_months,\n       i.name AS partner_institution, i.country, i.city,\n       COUNT(DISTINCT pres.presentation_id) AS presentation_count,\n       p.title AS project_title\nFROM Collaborations c\nJOIN Institutions i ON c.institution_id = i.institution_id\nJOIN Projects p ON c.project_id = p.project_id\nJOIN Presentations pres ON p.project_id = pres.project_id\nWHERE c.type = 'Образовательный'\nAND pres.date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY c.collaboration_id, c.type, c.description, c.contact_person, c.start_date, c.end_date, i.name, i.country, i.city, p.title\nORDER BY presentation_count DESC\nLIMIT 7;"
        },
        {
            "question": "Какие 12 публикаций с импакт-фактором выше 3.5 были опубликованы исследователями национальности 'Россия' за последние 4 года? Включите информацию о названии журнала, дате публикации, авторе и связанном проекте. Отсортируйте результаты по импакт-фактору в убывающем порядке.",
            "sql_query": "SELECT p.publication_id, p.title, p.journal, p.publication_date, p.doi, p.impact_factor,\n       r.first_name, r.last_name, r.nationality, r.position,\n       pr.title AS project_title, pr.status AS project_status\nFROM Publications p\nJOIN Projects pr ON p.project_id = pr.project_id\nJOIN Researchers r ON pr.project_lead_id = r.researcher_id\nWHERE p.impact_factor > 3.5\nAND r.nationality = 'Россия'\nAND p.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\nORDER BY p.impact_factor DESC\nLIMIT 12;"
        },
        {
            "question": "Какие 8 институтов типа 'Научно-исследовательский институт' имеют наибольшее количество активных проектов с суммарным бюджетом более 5 миллионов рублей? Включите информацию о городе, количестве активных проектов, общем бюджете и среднем бюджете на проект. Отсортируйте результаты по количеству проектов в убывающем порядке.",
            "sql_query": "SELECT i.institution_id, i.name, i.city, i.country, i.established_year,\n       COUNT(DISTINCT p.project_id) AS active_projects_count,\n       SUM(p.budget) AS total_budget,\n       AVG(p.budget) AS avg_project_budget\nFROM Institutions i\nJOIN Departments d ON i.institution_id = d.institution_id\nJOIN Projects p ON d.department_id = p.department_id\nWHERE i.type = 'Научно-исследовательский институт'\nAND p.status = 'Активный'\nGROUP BY i.institution_id, i.name, i.city, i.country, i.established_year\nHAVING SUM(p.budget) > 5000000\nORDER BY active_projects_count DESC\nLIMIT 8;"
        },
        {
            "question": "Какие 6 презентаций, проведенных в комнате 'Зал A' или 'Зал B', имели наибольшую продолжительность и были связаны с проектами, финансируемыми 'Фондом содействия инновациям' или 'Российским научным фондом'? Включите информацию о названии презентации, докладчике, конференции и длительности. Отсортируйте результаты по длительности в убывающем порядке.",
            "sql_query": "SELECT pres.presentation_id, pres.title, pres.room, pres.duration, pres.date, pres.abstract,\n       r.first_name AS presenter_first_name, r.last_name AS presenter_last_name, r.position,\n       c.name AS conference_name, c.location AS conference_location,\n       p.title AS project_title, g.funding_agency\nFROM Presentations pres\nJOIN Researchers r ON pres.presenter_id = r.researcher_id\nJOIN Conferences c ON pres.conference_id = c.conference_id\nJOIN Projects p ON pres.project_id = p.project_id\nJOIN Grants g ON p.project_id = g.project_id\nWHERE pres.room IN ('Зал A', 'Зал B')\nAND g.funding_agency IN ('Фонд содействия инновациям', 'Российский научный фонд')\nORDER BY pres.duration DESC\nLIMIT 6;"
        },
        {
            "question": "Какие 15 исследователей женского пола с должностью 'Научный сотрудник' или 'Старший научный сотрудник' имеют наибольшее количество публикаций и патентов в сумме за последние 5 лет? Включите информацию о количестве публикаций, патентов, общем импакт-факторе и отделе, в котором они работают. Отсортируйте результаты по общему количеству работ в убывающем порядке.",
            "sql_query": "SELECT r.researcher_id, r.first_name, r.last_name, r.position, r.email,\n       COUNT(DISTINCT pub.publication_id) AS publications_count,\n       COUNT(DISTINCT pat.patent_id) AS patents_count,\n       (COUNT(DISTINCT pub.publication_id) + COUNT(DISTINCT pat.patent_id)) AS total_works,\n       SUM(pub.impact_factor) AS total_impact_factor,\n       d.name AS department_name, i.name AS institution_name\nFROM Researchers r\nLEFT JOIN Projects p ON r.researcher_id = p.project_lead_id\nLEFT JOIN Publications pub ON p.project_id = pub.project_id AND pub.publication_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nLEFT JOIN Patents pat ON r.researcher_id = pat.inventor_id AND pat.application_date >= DATE_SUB(CURRENT_DATE, INTERVAL 5 YEAR)\nJOIN Departments d ON p.department_id = d.department_id\nJOIN Institutions i ON d.institution_id = i.institution_id\nWHERE r.gender = 'Женский'\nAND r.position IN ('Научный сотрудник', 'Старший научный сотрудник')\nGROUP BY r.researcher_id, r.first_name, r.last_name, r.position, r.email, d.name, i.name\nHAVING (COUNT(DISTINCT pub.publication_id) + COUNT(DISTINCT pat.patent_id)) > 0\nORDER BY total_works DESC\nLIMIT 15;"
        },
        {
            "question": "Какие 13 конференций с наибольшим количеством участников были проведены за последние 2 года и имеют хотя бы 3 презентации с длительностью более 60 минут? Включите информацию о месте проведения, организаторе, общем количестве презентаций и средней продолжительности презентаций. Отсортируйте результаты по количеству участников в убывающем порядке.",
            "sql_query": "SELECT c.conference_id, c.name, c.location, c.organizer, c.start_date, c.end_date,\n       c.number_of_participants,\n       COUNT(DISTINCT pres.presentation_id) AS presentations_count,\n       AVG(pres.duration) AS avg_presentation_duration,\n       COUNT(DISTINCT CASE WHEN pres.duration > 60 THEN pres.presentation_id END) AS long_presentations_count\nFROM Conferences c\nJOIN Presentations pres ON c.conference_id = pres.conference_id\nWHERE c.start_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nGROUP BY c.conference_id, c.name, c.location, c.organizer, c.start_date, c.end_date, c.number_of_participants\nHAVING COUNT(DISTINCT CASE WHEN pres.duration > 60 THEN pres.presentation_id END) >= 3\nORDER BY c.number_of_participants DESC\nLIMIT 13;"
        },
        {
            "question": "Какие 9 отделов с наибольшим бюджетом на этаже 2 или 3 имеют самое дорогостоящее оборудование, приобретенное за последние 4 года? Включите информацию о названии отдела, институте, количестве единиц оборудования и общей стоимости оборудования. Отсортируйте результаты по общей стоимости оборудования в убывающем порядке.",
            "sql_query": "SELECT d.department_id, d.name, d.building, d.floor, d.budget,\n       i.name AS institution_name, i.city, i.type,\n       COUNT(DISTINCT eq.equipment_id) AS equipment_count,\n       SUM(eq.cost) AS total_equipment_cost,\n       MAX(eq.cost) AS most_expensive_equipment\nFROM Departments d\nJOIN Institutions i ON d.institution_id = i.institution_id\nJOIN Equipment eq ON d.department_id = eq.department_id\nWHERE d.floor IN (2, 3)\nAND eq.purchase_date >= DATE_SUB(CURRENT_DATE, INTERVAL 4 YEAR)\nGROUP BY d.department_id, d.name, d.building, d.floor, d.budget, i.name, i.city, i.type\nORDER BY total_equipment_cost DESC\nLIMIT 9;"
        },
        {
            "question": "Какие 7 этических одобрений со статусом 'Одобрено' или 'Одобрено с условиями' были получены быстрее всего за последние 2 года? Включите информацию о названии комитета, контактном лице, связанном проекте и условиях одобрения. Отсортируйте результаты по скорости одобрения в возрастающем порядке.",
            "sql_query": "SELECT ea.approval_id, ea.status, ea.committee_name, ea.contact_person, ea.contact_email,\n       ea.application_date, ea.approval_date,\n       DATEDIFF(ea.approval_date, ea.application_date) AS approval_days,\n       p.title AS project_title, p.status AS project_status,\n       r.first_name AS lead_first_name, r.last_name AS lead_last_name,\n       ea.conditions\nFROM EthicsApprovals ea\nJOIN Projects p ON ea.project_id = p.project_id\nJOIN Researchers r ON p.project_lead_id = r.researcher_id\nWHERE ea.status IN ('Одобрено', 'Одобрено с условиями')\nAND ea.approval_date IS NOT NULL\nAND ea.application_date >= DATE_SUB(CURRENT_DATE, INTERVAL 2 YEAR)\nORDER BY approval_days ASC\nLIMIT 7;"
        }
    ]
}